<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=0">

		<title>订单</title>

		<link href="AmazeUI-2.4.2/assets/css/admin.css" rel="stylesheet" type="text/css">
		<link href="AmazeUI-2.4.2/assets/css/amazeui.css" rel="stylesheet" type="text/css">

		<link href="css/personal.css" rel="stylesheet" type="text/css">
		<link rel="stylesheet" type="text/css" href="bootstrap/frame/font-awesome-4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" type="text/css" href="bootstrap/frame/bootstrap2/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="bootstrap/frame/bootstrap-table-master/src/bootstrap-table.css">
		<link rel="stylesheet" type="text/css" href="bootstrap/frame/bootstrap3-editable-1.5.1/bootstrap3-editable/css/bootstrap-editable.css">
		<link rel="stylesheet" type="text/css" href="bootstrap/frame/bootstrap-fileinput-master/css/fileinput.css">

		<script charset="UTF-8" type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
		<script charset="UTF-8" src="bootstrap/frame/jquery/jquery-3.3.1.js"></script>
		<script charset="UTF-8" src="bootstrap/frame/layer/layer.js"></script>
		<script charset="UTF-8" src="bootstrap/frame/bootstrap-table-master/src/bootstrap-table.js"></script>
		<script charset="UTF-8" src="bootstrap/frame/bootstrap3-editable-1.5.1/bootstrap3-editable/js/bootstrap-editable.js"></script>
		<script charset="UTF-8" type="text/javascript" src="bootstrap/frame/bootstrap-table-master/src/locale/bootstrap-table-en-US.js"></script>
		<script charset="UTF-8" type="text/javascript" src="bootstrap/frame/bootstrap-table-master/dist/extensions/editable/bootstrap-table-editable.min.js"></script>
		<script charset="UTF-8" type="text/javascript" src="bootstrap/frame/bootstrap2/js/bootstrap.min.js"></script>

		<script src="AmazeUI-2.4.2/assets/js/jquery.min.js" type="text/javascript"></script>
		<script src="AmazeUI-2.4.2/assets/js/amazeui.js" type="text/javascript"></script>
		
	</head>

	<body>
		<!--头 -->
		<header>
			<article>
				<div class="mt-logo">
					<!--顶部导航条 -->
					<div class="am-container header">
						<ul class="message-l">
							<div class="topMessage">
								<div class="menu-hd">
									<a href="#" target="_top" class="h">亲，请登录</a>
									<a href="#" target="_top">免费注册</a>
								</div>
							</div>
						</ul>
						<ul class="message-r">
							<div class="topMessage home">
								<div class="menu-hd"><a href="#" target="_top" class="h">商城首页</a></div>
							</div>
							<div class="topMessage my-shangcheng">
								<div class="menu-hd MyShangcheng"><a href="#" target="_top"><i class="am-icon-user am-icon-fw"></i>个人中心</a></div>
							</div>
							<div class="topMessage mini-cart">
								<div class="menu-hd"><a id="mc-menu-hd" href="#" target="_top"><i class="am-icon-shopping-cart  am-icon-fw"></i><span>购物车</span><strong id="J_MiniCartNum" class="h">0</strong></a></div>
							</div>
							<div class="topMessage favorite">
								<div class="menu-hd"><a href="#" target="_top"><i class="am-icon-heart am-icon-fw"></i><span>收藏夹</span></a></div>
						</ul>
						</div>

						<!--悬浮搜索框-->

						<div class="nav white">
							<div class="logoBig">
								<li><img src="images/logobig.png" /></li>
							</div>

							<div class="search-bar pr">
								<a name="index_none_header_sysc" href="#"></a>
								<form>
									<input id="searchInput" name="index_none_header_sysc" type="text" placeholder="搜索" autocomplete="off">
									<input id="ai-topsearch" class="submit am-btn" value="搜索" index="1" type="submit">
								</form>
							</div>
						</div>

						<div class="clear"></div>
					</div>
				</div>
			</article>
		</header>

		<div class="nav-table">
			<div class="long-title"><span class="all-goods">全部分类</span></div>
			<div class="nav-cont">
				<ul>
					<li class="index"><a href="#">首页</a></li>
					<li class="qc"><a href="#">闪购</a></li>
					<li class="qc"><a href="#">限时抢</a></li>
					<li class="qc"><a href="#">团购</a></li>
					<li class="qc last"><a href="#">大包装</a></li>
				</ul>
				<div class="nav-extra">
					<i class="am-icon-user-secret am-icon-md nav-user"></i><b></b>我的福利
					<i class="am-icon-angle-right" style="padding-left: 10px;"></i>
				</div>
			</div>
		</div>
		<b class="line"></b>

		<div class="center">
			<div class="col-main">
				<div class="main-wrap">
						<!--标题 -->
						<div class="am-cf am-padding">
							<div class="am-fl am-cf"><strong class="am-text-danger am-text-lg">订单管理</strong> / <small>Order</small></div>
						</div>
						<hr/>
						<table id="page"></table>
					<script>
                        $(function () {
                            initTable();//调用函数，初始化表格
                            //$("#queryBtn").bind("click", initTable); //当点击查询按钮的时候执行,bootstrap-table前端分页是不能使用搜索功能
                            //("#remove").on("click", remove);
                        });

                        /*function remove() {
                            var rows = $("#page").bootstrapTable('getSelections'); //一定要使用bootstrapTable显示表格
                            console.log(rows);
                            if (rows.length == 0) {// rows 主要是为了判断是否选中，下面的else内容才是主要
                                alert("请先选择要删除的记录!");
                                return;
                            } else {
                                var arrays = new Array();// 声明一个数组

                                $(rows).each(function () {// 通过获得选中的来进行遍历
                                    arrays.push(this.vipId);// cid为获得到的整条数据中的一列
                                });
                                var vipId = arrays.join(','); // 获得要删除的id
                                alert(vipId);
                                console.log(vipId);
                            }
                            $.ajax({
                                type: "post",
                                url: "vip/delVip",
                                data: {
                                    vipId:vipId,
                                    row:rows.length
                                },
                                dataType: 'JSON',
                                success: function (data, status) {
                                    if (status == "success") {
                                        alert('删除数据成功');
                                        initTable();
                                    }
                                },
                                error: function () {
                                    alert('删除失败');
                                },
                                complete: function () {
                                }
                            });
                        };*/


                        function initTable() {
                            $('#page').bootstrapTable('destroy'); //先销毁表格
                            $('#page').bootstrapTable({
                                url:"order/getOrders",
                                method:'post',
                                toolbar: "#toolbar",
                                striped: true, // 是否显示行间隔色 //search : "true",
                                sidePagination: "server",
                                pageNumber: 1, //初始化加载第一页，默认第一页
                                pageList:[3,5,8,10],//可供选择的每页的行数
                                pageSize:5,//初始默认每页行数
                                pagination: true,
                                showRefresh: true,//刷新
                                showPaginationSwitch: true,//是否隐藏分页条
                                showToggle:true, //是否显示详细视图和列表视图的切换按钮
                                // clickToSelect: true,点击选中
                                editable:true,
                                contentType: "application/x-www-form-urlencoded",
                                paginationPreText:"上一页",
                                paginationNextText:"下一页", //设置为 ‘limit’ 则会发送符合 RESTFul 格式的参数.
                                queryParamsType : "limit",//设置为 ‘limit’ 则会发送符合 RESTFul 格式的参数.
                                sortable: true, // 是否启用排序
                                // queryParams: queryParams, //queryParams为参数设置的函数
                                queryParams: function (params) {//自定义参数，这里的参数是传给后台的，我这是是分页用的
                                    //            请求服务器数据时，你可以通过重写参数的方式添加一些额外的参数，例如 toolbar 中的参数 如果
                                    //　　　　　　　queryParamsType = 'limit' ,返回参数必须包含limit, offset, search, sort, order
                                    //            queryParamsType = 'undefined', 返回参数必须包含: pageSize, pageNumber, searchText, sortName, sortOrder.
                                    //            返回false将会终止请求。
                                    return {//这里的params是table提供的
                                        pageNum: (params.offset / params.limit) + 1, //当前页面,默认是上面设置的1(pageNumber)
                                        pageSize : params.limit ,//每一页的数据行数，默认是上面设置的5(pageSize)
                                        type: selType,
                                        key: key,
                                        // username: $("#searchString_id").val() //这个就是搜索框中的内容，可以自动传到后台，搜索实现在xml中体现
                                    };
                                },
                                columns: [
                                    {
                                        checkbox: true
                                    }, {
                                        field: 'vipId',
                                        title: '会员编号'
                                    },
                                    {
                                        field: 'name',
                                        title: '姓名',
                                        editable:{
                                            type:"text",
                                            title:"姓名",
                                            mode:"inline",
                                            validate:function(v){
                                                if(v=="")
                                                    return "姓名不能为空";
                                            }
                                        }
                                    },
                                    {
                                        field: 'sex',
                                        title: '性别',
                                        editable:{
                                            type:"text",
                                            title:"性别",
                                            mode:"inline",
                                            validate:function(v){
                                                if(!/^(男|女)$/.test(v))
                                                    return "性别不合法";
                                            }
                                        }
                                    },
                                    {
                                        field: 'idCard',
                                        title: '身份证',
                                        editable:{
                                            type:"text",
                                            title:"身份证",
                                            mode:"inline",
                                            validate:function(v){
                                                if(!/^[1-9]{1}[0-9]{16}([0-9]|[xX])$/.test(v))
                                                    return "身份证不合法";
                                            }
                                        }
                                    },
                                    {
                                        field: 'phone',
                                        title: '手机号',
                                        editable:{
                                            type:"text",
                                            title:"手机号",
                                            mode:"inline",
                                            validate:function(v){
                                                if(!/^\d{11}$/.test(v))
                                                    return "手机号不合法";
                                            }
                                        }
                                    },
                                    {
                                        field: 'level',
                                        title: '会员等级',
                                        editable:{
                                            type:"text",
                                            title:"会员等级",
                                            mode:"inline",
                                            validate:function(v){
                                                if(!/^[1-6]*$/.test(v))
                                                    return "会员等级不合法";
                                            }
                                        }
                                    },
                                    {
                                        field: 'addMonetary',
                                        title: '累计消费',
                                        editable:{
                                            type:"text",
                                            title:"累计消费",
                                            mode:"inline",
                                            validate:function(v){
                                                if(!/^\d{1,11}$/.test(v))
                                                    return "累计消费不合法";
                                            }
                                        }

                                    },
                                    {
                                        field:'operate',
                                        title:'操作',
                                        width:'40px',
                                        align: 'center',
                                        events : 'operateEvents',
                                        formatter:'operateFormatter'
                                    }],
                                onLoadSuccess: function(){  //加载成功时执行
                                    console.info("加载数据成功");
                                },
                                onLoadError: function(){  //加载失败时执行
                                    console.info("加载数据失败");
                                },
                                onEditableSave: function (field, row, oldValue, $el) {//行内编辑
                                    $.ajax({
                                        type: "post",
                                        url: "vip/updateVip",
                                        data: {
                                            _method:"put",
                                            vipId:row.vipId,
                                            name:row.name,
                                            sex:row.sex,
                                            idCard:row.idCard,
                                            phone:row.phone,
                                            level:row.level,
                                            addMonetary:row.addMonetary
                                        },
                                        dataType: 'JSON',
                                        success: function (data, status) {
                                            console.log($el);
                                            console.log(field);
                                            console.log(row);
                                            if (status == "success") {
                                                console.log('修改数据成功');
                                            }
                                        },
                                        error: function () {
                                            console.log('修改数据失败');
                                        },
                                        complete: function () {
                                        }
                                    });
                                }
                            });
                        };
                        function operateFormatter(value, row, index) { //要进行的操作 操作函数
                            return [
                                "<button  class='remove btn btn-xs green' title='删除'>" +
                                "<span class='glyphicon glyphicon-remove'></span></button>"+
                                ""
                            ].join('')
                        }

                        window.operateEvents = {
                            'click .remove': function (e, value, row, index) {
                                //alert(row.vipId);
                                var vipId = row.vipId;
                                var temp = confirm("是否确认删除?");
                                if(temp){
                                    $.ajax({
                                        type: "post",
                                        url: "vip/delVip",
                                        data: {
                                            vipId:vipId
                                        },
                                        dataType: 'JSON',
                                        success: function (data, status) {
                                            if (status == "success") {
                                                alert('删除数据成功');
                                                initTable();
                                            }
                                        },
                                        error: function () {
                                            alert('删除失败');
                                        },
                                        complete: function () {
                                        }
                                    });
                                }
                            }
                        };
					</script>
				</div>
			</div>

			<aside class="menu">
				<ul>
					<li class="person active">
						<i class="am-icon-user"></i>我的订单
					</li>
					<li class="person">
						<p><i class="am-icon-newspaper-o"></i>个人订单</p>
						<ul>
							<li> <a href="#">订单查看</a></li>
						</ul>
					<!--<li class="person">
						<p><i class="am-icon-newspaper-o"></i>个人资料</p>
						<ul>
							<li> <a href="information.html">个人信息</a></li>
							<li> <a href="safety.html">安全设置</a></li>
							<li> <a href="address.html">地址管理</a></li>
							<li> <a href="cardlist.html">快捷支付</a></li>
						</ul>
					</li>
					<li class="person">
						<p><i class="am-icon-balance-scale"></i>我的交易</p>
						<ul>
							<li><a href="order.html">订单管理</a></li>
							<li> <a href="change.html">退款售后</a></li>
							<li> <a href="comment.html">评价商品</a></li>
						</ul>
					</li>
					<li class="person">
						<p><i class="am-icon-dollar"></i>我的资产</p>
						<ul>
							<li> <a href="points.html">我的积分</a></li>
							<li> <a href="coupon.html">优惠券 </a></li>
							<li> <a href="bonus.html">红包</a></li>
							<li> <a href="walletlist.html">账户余额</a></li>
							<li> <a href="bill.html">账单明细</a></li>
						</ul>
					</li>

					<li class="person">
						<p><i class="am-icon-tags"></i>我的收藏</p>
						<ul>
							<li> <a href="collection.html">收藏</a></li>
							<li> <a href="foot.html">足迹</a></li>					
						</ul>
					</li>

					<li class="person">
						<p><i class="am-icon-qq"></i>在线客服</p>
						<ul>
							<li> <a href="consultation.html">商品咨询</a></li>
							<li> <a href="suggest.html">意见反馈</a></li>							
							
							<li> <a href="news.html">我的消息</a></li>
						</ul>
					</li>
				</ul>-->

			</aside>
		</div>

	</body>

</html>